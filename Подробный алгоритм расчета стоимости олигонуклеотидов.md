#### **1. Простой олигонуклеотид без модификаций**

##### **Входные данные:**

- **Последовательность:** строка, состоящая из букв A, C, G, T (заглавные или строчные).  
    Пример: `ACGTACGT`.
- **Масштаб синтеза (в о.е.):** минимальный (`min`) или заданный числом (например, `10`, `20`, `40` и т.д.).

##### **Алгоритм:**

1. Проверяем корректность последовательности:
    - Убедиться, что она состоит только из допустимых символов ( строчные и прописные буквы латинского алфавита, цифры, а также символы: `. * - /`).
    - Если есть некорректные символы → ошибка.
2. Рассчитываем базовую стоимость:
    - **Сумма стоимости всех букв в последовательности.**
    - Каждая буква берется из прайса на основании масштаба синтеза.  
        Пример:
        - `A = 1.2 у.е.` для 10 о.е.
        - `C = 1.3 у.е.` для 10 о.е.
        - **Сумма:** `1.2 + 1.3 + 1.2 + 1.3 + 1.2 + 1.3 + 1.2 + 1.3 = 10.0 у.е.`.
3. Если масштаб >40 о.е.:
    - Применяется формула:  
        **`стоимость = количество о.е. × стоимость за о.е.`.**  
        Пример: для масштаба 50 о.е. и стоимости 5 у.е./о.е.
        `50 × 5 = 250 у.е.`.

---
#### **2. Олигонуклеотид с модификациями**

##### **Входные данные:**

- **Последовательность:** строка с токенами букв и внутренних модификаций, например:  
    `ACGT/dT-Alk/ACGT`.
- **Внешние модификации:**
    - **5’-модификация** (например, `Bio`).
    - **3’-модификация** (например, `FAM`).
- **Масштаб синтеза (в о.е.):** минимальный или заданный числом.

##### **Алгоритм:**

1. Проверяем корректность данных:
    - Убедиться, что строка состоит только из допустимых символов
    - Убедиться, что заданны корректные внешние модификации в нужных позициях
    - Если есть некорректные данные → ошибка.
      
2. Рассчитываем стоимость последовательности:
    - Суммируем стоимость всех букв в последовательности (как в простом случае).
    - Добавляем стоимость внутренних модификаций:
        - Например: `/dT-Alk/` стоит 10 у.е.  
            Если последовательность: `ACGT/dT-Alk/ACGT`, то стоимость букв + 10 у.е.
    - **Пример:**  
        Последовательность: `ACGT/dT-Alk/ACGT`.
        - Буквы: `1.2 + 1.3 + 1.2 + 1.3 + 1.2 + 1.3 + 1.2 + 1.3 = 10.0 у.е.`.
        - Внутренняя модификация: `/dT-Alk/ = 10 у.е.`.
        - **Итого:** `10.0 + 10.0 = 20.0 у.е.`.
          
3. Добавляем стоимость внешних модификаций:
    - Стоимость берется из прайса.
    - **Пример:**
        - 5’-модификация: `Bio = 5 у.е.`.
        - 3’-модификация: `FAM = 7 у.е.`.
        - **Итого:** `5 + 20.0 + 7 = 32.0 у.е.`.
          
4. Применяем масштаб синтеза (>40 о.е., если применимо):
    - Аналогично простому варианту.

---

#### **3. Зонд**

##### **Входные данные:**

- **Последовательность:** строка с токенами букв и модификаций, например:  
    `ACGT/dT-FAM/ACGT/dT-BHQ1/`.
- **Обязательно пара:** краситель + гаситель.
- **Модификации:**
    - Внешние модификации (5’, 3’) или внутренние модификации.
    - Всегда есть как минимум одна модификация (краситель или гаситель)
- **Масштаб синтеза (в о.е.):** минимальный или заданный числом.

##### **Алгоритм:**

1. Проверяем корректность данных:
    - Убедиться, что есть корректная пара краситель/гаситель (есть в прайсе).
    - Если есть 1 или более красителя и 1 и более гасителя, но пара в прайсе отсутствует → ошибка.
      
2. Рассчитываем стоимость зонда:
    - Для заданной пары краситель/гаситель берем стоимость из прайса.
    - **Пример:**
        - Пара `FAM` и `BHQ1` стоит 50 у.е. (масштаб до 40 о.е.).
          
3. Добавляем стоимость дополнительных модификаций (если есть):
    - Например, если зонд содержит еще один краситель, его стоимость добавляется как модификация.
      
4. Применяем масштаб синтеза (>40 о.е., если применимо):
    - Аналогично предыдущим вариантам.
    - **Формула:**  
        `стоимость = кол-во о.е. × стоимость за о.е.`.


---

#### **4. Общий алгоритм**

##### **Входные данные:**

- **Последовательность:** строка с токенами букв и внутренних модификаций, например:  
    `ACGT/dT-Alk/ACGT/dT-BHQ1/`.
- **Внешние модификации:**
    - **5’-модификация** (`FAM`).
    - **3’-модификация** (`JOE`)
- **Масштаб синтеза (в о.е.):** минимальный или заданный числом.

1. Проверка последовательности:
    - Проверяем, что строка состоит только из допустимых символов
    - Проверяем, что заданы корректные внешние модификации в нужных позициях
    - Если есть некорректные данные → ошибка.
3. Токенизация последовательности: 
	1. Токены модификации, которые распределяются по типу:
		1. Краситель
		2. Гаситель
		3. Обычная модификация
	2. Токены праймеров
	3. Токены гуанина
4. Проверка наличия зонда в последовательности
	1. Если есть как минимум один краситель и один гаситель, а также присутствует хотя бы одна внешняя модификация
		1. Проверяем, присутствует ли их комбинация среди возможных составляющих зонд
		2. Если зонд найден, рассчитываем его стоимость
			1. Если масштаб синтеза <40 (порогового значения) масштаб
				1. стоимость = стоимость зонда за соответсвующий масштаб
			2. Если масштаб синтеза >=40 (порогового значения) о.е.
				1. стоимость = стоимость зонда за о.е * количество o.e
		3. `Если пара не составляет зонд → ошибка`
5. Расчет стоимости внутренних и внешних модификаций
	1. Рассчитываем сумму внутренних модификаций
		1. Проверяем, что модификация не входит в зонд
			1. Добавляем стоимость внутренней модификации
	2. Расчет стоимости внешних модификаций
		1. Если в последовательности есть зонд
			1. Проверяем, что модификация 3' не входит в зонд
				1. Проверяем, что внешняя модификация стоит на разрешенном месте (есть цена в прайсе)
					1. Добавляем стоимость внешней модификации 3' 
			2. Проверяем, что модификация 5' не входит в зонд
				1. Проверяем, что внешняя модификация стоит на разрешенном месте (есть цена в прайсе)
					1. Добавляем стоимость внешней модификации 5'
		2. Если в последовательности нет зондов, добавляем стоимость внешних модификаций
6. Расчет стоимости буквенной последовательности
	1. Если масштаб синтеза <40 (порогового значения)
		1. стоимость = сумме токенов букв праймеров
	2. Если масштаб синтеза >=40 (порогового значения)
		1. стоимость = стоимость праймера за о.е. * кол-во о.е.
7. Проверка повышающих коэффициентов:
	1. Проверяем длину олига в соответствии с полученными токенами
	2. Проверяем содержание гуанина
		1. Если содержание гуанина более 50%
			1. Применяем повышающий коэффициент
			2. `Дальнейшую проверку можно опустить`
	3. Если токенов гуанина 6 или более и они идут подряд
			1. Применяем повышающий коэффициент
			2. `Дальнейшую проверку можно опустить`
		1. Проверяем наличие последовательностей гуанина
			1. Если найдена хотя бы одна из последовательностей
				1. Применяем повышающий коэфициент
	4. Проверяем количество красителей и гасителей
	5. Проверяем количество внутренних модификаций
8. Рассчитываем общую стоимость последовательности с применением полученных повышающих коэффициентов
	1. Если есть зонд
		1. `((стоимость зонда) + (стоимость внутренних модификаций) + (стоимость внутренних модификаций)) * (произведение повышающих коэффициентов)`
	2. Если зонда нет
		1. `((стоимость внешних модификаций) + (сумма стоимости букв) + (стоимость внутренних модификаций)) * (произведение повышающих коэффициентов)`
9. Формируем файл с результатами расчета стоимости
---
### Примеры расчета

#### **Пример 1: Простой олигонуклеотид**

- Последовательность: `ACGTACGT`.
- Масштаб синтеза: `5 о.е.`
- Прайс: `A = 39`, `C = 39`, `G = 39`, `T = 39`.
- **Итог:**  
    `39 + 39 + 39 + 39 + 39 + 39 + 39 + 39 = 312 у.е.`.

---

#### **Пример 2: Олигонуклеотид с модификациями**

- Последовательность: `ACGT/dT-Alk/ACGT`.
- Масштаб синтеза: `5 о.е.`
- Прайс:
    - Внутренняя модификация `/dT-Alk/ = 975,00 у.е.`.
    - 5’-модификация: `Bio = 1 687,50 у.е.`.
    - 3’-модификация: `FAM = 975,00 у.е.`.
- **Итог:**  
    `312,00 + 975,00 + 1 687,50 + 975,00 = 3949,5 у.е.`.

---

#### **Пример 3: Зонд, большой масштаб синтеза**

- Последовательность: `ACGT/dT-FAM/ACGT`.
- Масштаб синтеза: `50 о.е.`
- Модификация 3': `BHQ1`
- Прайс:
    - Пара `dt-FAM` + `BHQ1` за 1 о.е.: `1 072,62 у.е.`
- **Итог:**  
    `1 072,62 * 50 = 53 631 у.е.`.

#### **Пример 4: Зонд, средний масштаб синтеза**

- Последовательность: `ACGT/dT-FAM/ACGT`.
- Масштаб синтеза: `min o.e.`
- Модификация 3': `BHQ1`
- Прайс:
    - Пара `dt-FAM` + `BHQ1` за min o.e.: `7 425,00 у.е`.
- **Итог:**  
    `7 425,00 у.е.`.
