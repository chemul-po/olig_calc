#### **Входные данные**

1. **Способы ввода данных:**
	- Через форму на сайте.
    - Загрузка файла XLS в стандартной форме («Стандартная_форма_заказа»).
    - Данные о клиенте и организации:
        - Берутся из личного кабинета (если пользователь авторизован).
        - Запрашиваются в форме.

1. **Поля ввода для расчета:**
	- Название.
    - Последовательность (5' → 3').
    - Количество (в о.е.), включая «min».
    - 5’ и 3’ модификации.
    - Галочка **GentaOligoPure** (указывает на повышенные требования к чистоте).

2. **Дополнительные поля при выводе результатов расчета**
    - Сложность.
    - Цена.

3. **Дополнительные данные:**
    - Выбор модификации (внешней и внутренней) из выпадающего списка.
    - Проверка введенных данных:
        - Удаление лишних символов (например, пробелов).
        - Ошибочные символы или модификации → сообщение пользователю.

4. **Изменяемость данных:**
    - Модератор калькулятора может выполнять добавление, изменение и удаление допустимого объема, стоимости, а также списка следующих параметров:
	    - Праймеры
	    - Внешние модификации
	    - Внутренние модификации
	    - Зонды
	

#### **Расчет**
#### 1. **Типы расчетов**

- **Олигонуклеотиды** (без зондов, но с модификациями или без них).
- **Зонды** (олигонуклеотиды с парой краситель/гаситель).

#### 2. **Алгоритм расчета для олигонуклеотидов**

##### 2.1 **Базовый расчет стоимости**

- **Формула:**  
    `Стоимость = сумма стоимости символов последовательности.`
    
- **Учет масштаба синтеза:**
    - До 40 о.е. включительно:
        - Стоимость считается как сумма стоимости всех символов последовательности.
    - Более 40 о.е.:
        - Стоимость считается по упрощенной формуле:  
            `Стоимость = кол-во о.е. × цена за о.е.`  
            (данные берутся из раздела «Праймеры много» в прайсе).

##### 2.2 **Учет модификаций**
- **Формула:**  
    `Стоимость = 5’-модификация + сумма стоимости символов последовательности + сумма стоимости внутренних модификаций + 3’-модификация.`
    
- Виды модификаций:
    - **Внешние**:
        - Указываются в столбцах формы
	        - «5’-модификация».
	        - «3’-модификация».
        - Стоимость зависит от масштаба синтеза.
          
    - **Внутренние**:
        - Указываются внутри последовательности через токены:  
            Пример: `ACGT/dT-Alk/ACGT`.
        - Стоимость берется из прайса, раздел
	        - «Внутренние модификации».
          
- **Ошибки в модификациях:**
    - Если модификация некорректна или отсутствует в прайсе сообщение:
	        _«Обратитесь к представителю компании»._

#### 3. **Алгоритм расчета для зондов**

##### 3.1 **Определение зонда**
- Зонд — олигонуклеотид с парой модификаций:
    - **Краситель**.
    - **Гаситель**.
- Все возможные пары краситель/гаситель указаны в прайсе
	- Раздел «Зонды».
- Если модификации не образуют зонд или пара отсутствует в прайсе сообщение:  
	- _«Обратитесь к представителю компании»._

##### 3.2 **Формула расчета**
- **Если зонд определен:**
    - `Стоимость = цена за пару краситель/гаситель (из раздела «Зонды»).`
- **При масштабе >40 о.е.:**
    - `Стоимость = кол-во о.е. × цена за о.е.`  
        (из раздела прайса «Зонды много»).
- **Дополнительные модификации в зонде:**
    - Если зонд содержит дополнительные красители или гасители:
        - Их стоимость добавляется к базовой стоимости зонда.

#### 4. **Повышающие коэффициенты**

##### 4.1 **Коэффициенты и их применение**

Стоимость рассчитывается с учетом повышающих коэффициентов:  
`Итоговая стоимость = стандартная стоимость × коэффициенты.`

##### 4.2 **Список коэффициентов**
1. **GentaOligoPure:**
    - Если галочка активна:
	    - коэффициент = 1.3.
	      
1. **Длина ≥36 токенов:**
    - коэффициент = 1.3.
      
2. **G-богатая последовательность:**
    - Гуанины (`G, +G, oG, mG, fG, rG`) составляют ≥50% длины
	    - коэффициент = 1.3.
	- `Не применяется, если имеются G-повторы`
	      
3. **Повторы G в последовательности:**
	- `G` может быть в следующих вариациях:
		- `G`, `+G`, `oG`, `mG`, `fG`, `rG`
    - Существуют специфические шаблоны повторов G:
        - `GGG-x-GGG` (`x` ≤ 6 токенов), от 2 повторений структуры.
        - `GGGGGG` (6 и более G подряд), от 1 повторения структуры.
        - `GGGG-x-GGGG` (`x` ≤ 6 токенов), от 1 повторения структуры.
    - коэффициент = 1.3.
    - `Не применяется, если последовательность G-богатая`
      
4. **Дополнительные модификации:**
    - Два и более красителей или два и более гасителей:
	    - коэффициент = 1.3.
    - Три и более внутренних модификаций:
	    - коэффициент = 1.3.

##### 4.3 **Пример применения коэффициентов**

Если последовательность содержит G-богатые повторы и длина ≥36 токенов:

`Итоговая стоимость = базовая стоимость × 1.3 × 1.3.`

#### 5. **Пример расчета**

##### Пример 1: Олигонуклеотид без модификаций
- Последовательность: `ACGTACGT`.
- Масштаб синтеза: 10 о.е.
- `Стоимость = сумма стоимости букв.`

##### Пример 2: Олигонуклеотид с модификациями
- Последовательность: `ACGT/dT-Alk/ACGT`.
- Масштаб синтеза: 20 о.е.
- `Стоимость = 5’-модификация + стоимость букв + внутренняя модификация + 3’-модификация.`

##### Пример 3: Зонд
- Последовательность: `ACGT/dT-FAM/ACGT`.
- Масштаб синтеза: 50 о.е.
- Пара краситель/гаситель: `FAM` / `BHQ1`.
- `Стоимость = кол-во о.е. × цена за о.е.` (раздел «Зонды много»).

#### 6. **Обработка ошибок**
- Некорректные данные:
	- расчет не производится.
	- выводится сообщение и предлагается связаться с компанией.
#### **Выходные данные**

1. **Формирование выходных данных:**
    - XLS-файл в формате формы заказа:
        - Длина последовательности.
        - Примененные повышающие коэффициенты.
        - Итоговая стоимость.
    - Информация в веб-форме:
        - Цена за каждую позицию.
        - Общая сумма заказа.
          
2. **Коммерческое предложение (КП):**
    - Формируется как XLS-файл:
        - Номенклатура по масштабу синтеза (min, 20 о.е. и т.д.).
        - Учет НДС.
        - Указание повышающих коэффициентов («GentaOligoPure», «custom»).

#### **Управление и доступ**

1. **Изменения прайса и модификаций:**
    - Через веб-интерфейс.
    - Без программирования.
      
2. **Разграничение прав:**
    - КП формируется только для авторизованных пользователей.
